#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Find lib directory: check ../lib first (installed), then ../../lib (project)
if [[ -d "${SCRIPT_DIR}/../lib" ]]; then
    LIB_DIR="${SCRIPT_DIR}/../lib"
else
    LIB_DIR="${SCRIPT_DIR}/../../lib"
fi

DICT_FILE="${LIB_DIR}/dictionary.txt"

# Parse flags
ADD_WORD=""
while getopts "d:a:" opt; do
    case "$opt" in
        d)
            DICT_FILE="$OPTARG"
            ;;
        a)
            ADD_WORD="$OPTARG"
            ;;
        *)
            echo "Usage: $0 [-d DICT_FILE] [-a WORD]" >&2
            exit 1
            ;;
    esac
done

# If -a flag was provided, append word to dictionary and re-sort
if [[ -n "$ADD_WORD" ]]; then
    echo "$ADD_WORD" >> "$DICT_FILE"
    sort -o "$DICT_FILE" "$DICT_FILE"
    exit 0
fi

# Compare stdin word list against dictionary
# Output words in stdin that are NOT in dictionary
comm -23 - "$DICT_FILE"
